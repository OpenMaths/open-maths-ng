<nav class="progress">
	<ul id="nav" class="container-narrow flex center-vertically align-left">
		<li ng-repeat="key in stepsKeys" ng-click="goToStep(key)"><span id="{{ key }}" class="flex center-vertically" ng-class="{active : stepsKeys[activeStep] == key}">{{ steps[key] }}</span></li>
	</ul>
</nav>

<article>
	<!--NOTE the name attr is needed for error messages-->
	<form name="formBasicSettings" class="container-narrow" ng-show="activeStep == 0">
		<header>
			<h2>Create a new contribution</h2>

			<p>To ensure every contribution is as relevant and valuable as possible, we feature automatic
				checker and validator, as well as interactive guidance to assist you with the process.</p>
		</header>

		<!--Type-->
		<label class="flex">
			<p class="flex-2">
				Type
				<small ng-class="{active : showInstructions == 'umiType'}">{{ formInstructions.umiType }}
				</small>
			</p>
			<div class="flex-7">
				<select ng-focus="showInstructions = 'umiType'"
						ng-options="type as type.label for type in formUmiTypes track by type.id"
						ng-model="createUmiForm.umiType"
						name="type" required>
					<option value="">Select Type</option>
				</select>
			</div>
		</label>

		<!--Error messages for Type-->
		<div class="error-messages" ng-show="showInstructions == 'umiType'">
			<div class="alert error" ng-show="formBasicSettings.type.$error.required">{{ formErrorMessages.required }}</div>
		</div>

		<!--Title-->
		<label class="flex">
			<p class="flex-2">
				Title
				<small ng-class="{active : showInstructions == 'title'}">{{ formInstructions.title }}
				</small>
			</p>
			<div class="flex-7">
				<input ng-focus="showInstructions = 'title'"
					   ng-pattern="/^(?=.*[^\W\'_-])[\w\' -]*$/" ng-model="createUmiForm.title"
					   ng-maxlength="128" type="text" name="title"
					   placeholder="Title"
					   required>
			</div>
		</label>

		<!--Error messages for Title-->
		<div class="error-messages" ng-show="showInstructions == 'title'">
			<div class="alert error" ng-show="formBasicSettings.title.$error.required">{{ formErrorMessages.required }}</div>
			<div class="alert error" ng-show="formBasicSettings.title.$error.maxlength">{{ formErrorMessages.maxLength }}</div>
			<div class="alert error" ng-show="formBasicSettings.title.$error.pattern">{{ formErrorMessages.umiTitle }}</div>
		</div>

		<!--Title Synonyms-->
		<label class="flex flex-item">
			<p class="flex-2">
				Title Synonyms
				<small ng-class="{active : showInstructions == 'titleSynonyms'}">{{ formInstructions.titleSynonyms }}
				</small>
			</p>
			<div class="flex-7">
				<input ng-focus="showInstructions = 'titleSynonyms'"
					   ng-model="createUmiForm.titleSynonyms" ng-maxlength="128"
					   type="text"
					   name="titleSynonyms"
					   placeholder="Title Synonyms"/>
			</div>
		</label>

		<!--Error messages for Title Synonyms-->
		<div class="error-messages" ng-show="showInstructions == 'titleSynonyms'">
			<div class="alert error" ng-show="formBasicSettings.titleSynonyms.$error.maxlength">{{ formErrorMessages.maxLength }}</div>
		</div>

		<label class="flex center-vertically button-holder">
			<!--@TODO fix this issue (probably flexbox)-->
			<div class="toggle-holder flex center-vertically" ng-show="createUmiForm.umiType.formal">
				<div class="toggle flex" ng-click="toggleFormalVersion()" ng-class="{active : formalVersion}"></div>
				<small>This is <span ng-hide="formalVersion">not</span> a <strong>Formal Version</strong></small>
			</div>

			<button name="next" class="button primary align-right" ng-disabled="!formBasicSettings.$valid" ng-click="activeStep = activeStep + 1">Proceed to <strong>{{ steps[stepsKeys[activeStep + 1]] }}</strong></button>
		</label>
	</form>

	<form name="formEditor" ng-show="activeStep == 1">
		<header class="container-narrow">
			<h2>Content for <strong>{{ createUmiForm.title }}</strong></h2>

			<p>To ensure every contribution is as relevant and valuable as possible, we feature automatic
				checker and validator, as well as interactive guidance to assist you with the process.</p>
		</header>

		<section class="controls flex">
			<ul class="flex center-vertically align-right">
				<li><span id="parsing" class="flex center-vertically" ng-show="parsingContent">Parsing</span></li>
				<li><span id="time-scale" class="flex center-vertically" ng-show="timeScale">{{ timeScale }}</span></li>
				<li><span id="locked" class="flex center-vertically">Locked</span></li>
			</ul>
		</section>

		<div class="flex latex-content-editor">
			<!--Content-->
			<div class="flex-1">
				<textarea ng-focus="showInstructions = 'content'"
						  ng-model="createUmiForm.content" name="content"
						  placeholder="Contents of your contribution" required ng-change="latexToHtml()"></textarea>
			</div>

			<div class="flex-1">
				<p class="latex-content-preview" om-bind="parsedContent || 'Parsed content will be displayed here'"></p>
			</div>

			<!--Error messages for LaTeX Content-->
			<div class="error-messages full-screen" ng-show="showInstructions == 'content'">
				<div class="alert error" ng-show="formEditor.content.$error.required">{{ formErrorMessages.required }}</div>
			</div>

			<div class="error-messages full-screen" ng-show="editorError.message">
				<div class="alert error">{{ editorError.message }} <strong>near</strong> "{{ editorError.where }}"</div>
			</div>
		</div>

		<div class="container-narrow">
			<!--Prerequisite definitions-->
			<label class="flex flex-item">
				<p class="flex-2">
					Prerequisite definitions
					<small ng-class="{active : showInstructions == 'prerequisiteDefinitionIds'}">{{ formInstructions.prerequisiteDefinitionIds }}</small>
				</p>
				<div class="flex-7" autocomplete model="createUmiForm.prerequisiteDefinitionIds"></div>
			</label>

			<!--See also-->
			<label class="flex flex-item">
				<p class="flex-2">
					See also
					<small ng-class="{active : showInstructions == 'seeAlsoIds'}">{{ formInstructions.seeAlsoIds }}</small>
				</p>

				<div class="flex-7" autocomplete model="createUmiForm.seeAlsoIds"></div>
			</label>

			<!--Tags-->
			<label class="flex flex-item">
				<p class="flex-2">
					Tags
					<small ng-class="{active : showInstructions == 'tags'}">{{ formInstructions.tags }}
					</small>
				</p>

				<div class="flex-7">
					<input ng-focus="showInstructions = 'tags'" ng-model="createUmiForm.tags"
						   ng-maxlength="128" type="text" name="tags"
						   placeholder="Tags"/>
				</div>
			</label>

			<!--Error messages for Tags-->
			<div class="error-messages" ng-show="showInstructions == 'tags'">
				<div class="alert error" ng-show="formEditor.tags.$error.maxlength">{{ formErrorMessages.maxLength }}</div>
			</div>

			<label class="flex button-holder">
				<button class="button default" ng-click="activeStep = activeStep - 1">Back</button>
				<button name="next" class="button primary align-right" ng-disabled="!formEditor.$valid || editorError" ng-click="activeStep = activeStep + 1">Proceed to <strong>{{ steps[stepsKeys[activeStep + 1]] }}</strong></button>
			</label>
		</div>
	</form>

	<div class="container-narrow" ng-show="activeStep == 2">
		<header>
			<h2>Preview: <strong>{{ createUmiForm.title }}</strong></h2>
			<p>This contribution will be published under {{ omUser.email }}.</p>
		</header>

		<div class="umi fade-in">
			<div class="content-holder">
				<div class="title flex center-vertically">
					<i class="edit"></i>
					<i class="full-screen"></i>
					<span class="label">{{ createUmiForm.umiType.label }}</span>
					<strong class="flex-1">{{ createUmiForm.title }}</strong>
				</div>
				<article>
					<p om-bind="parsedContent"></p>
				</article>
			</div>
		</div>

		<label class="flex button-holder">
			<button class="button default" ng-click="activeStep = activeStep - 1">Back</button>
			<button name="publish" class="button primary align-right" ng-click="createUmi()"><strong>Publish</strong> your contribution</button>
		</label>
	</div>

	</form>
</article>