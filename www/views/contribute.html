<!--Top navigation-->
<div nav-top></div>
<!--Top navigation-->

<nav class="progress">
	<ul id="nav" class="container-narrow flex  center-vertically align-left">
		<li ng-repeat="key in stepsKeys"><span id="{{ key }}" class="flex center-vertically" ng-class="{active : stepsKeys[activeStep] == key}">{{ steps[key] }}</span></li>
	</ul>
</nav>

<article>
	<!--NOTE the name attr is needed for error messages-->
	<form name="formBasicSettings" class="container-narrow" ng-show="activeStep == 0">
		<header>
			<h2>Create a new contribution</h2>
			<!--<h2 ng-show="editUmiData">Editing: <strong>{{ editUmiData.title.title }}</strong></h2>-->

			<p>To ensure every contribution is as relevant and valuable as possible, we feature automatic
				checker and validator, as well as interactive guidance to assist you with the process.</p>
		</header>

		<!--Type-->
		<label for="type" class="flex">
			<p class="flex-2">
				Type
				<small ng-class="{active : showInstructions == 'type'}">{{ instructions.type }}
				</small>
			</p>
			<div class="flex-7">
				<select ng-focus="showInstructions = 'type'"
						ng-options="type as type.label for type in umiTypes track by type.id"
						ng-model="createUmiForm.type"
						name="type" required>
					<option value="">Select Type</option>
				</select>
			</div>
		</label>

		<!--Error messages for Type-->
		<div class="error-messages" ng-show="showInstructions == 'type'">
			<div class="alert error" ng-show="formBasicSettings.type.$error.required">{{ errorMessages.required }}</div>
		</div>

		<!--Title-->
		<label for="title" class="flex">
			<p class="flex-2">
				Title
				<small ng-class="{active : showInstructions == 'title'}">{{ instructions.title }}
				</small>
			</p>
			<div class="flex-7">
				<input ng-focus="showInstructions = 'title'"
					   ng-pattern="/^(?=.*[^\W\'_-])[\w\' -]*$/" ng-model="createUmiForm.title"
					   ng-maxlength="128" type="text" name="title"
					   placeholder="Title"
					   required>
			</div>
		</label>

		<!--Error messages for Title-->
		<div class="error-messages" ng-show="showInstructions == 'title'">
			<div class="alert error" ng-show="formBasicSettings.title.$error.required">{{ errorMessages.required }}</div>
			<div class="alert error" ng-show="formBasicSettings.title.$error.maxlength">{{ errorMessages.maxLength }}</div>
			<div class="alert error" ng-show="formBasicSettings.title.$error.pattern">{{ errorMessages.umiTitle }}</div>
		</div>

		<!--Title Synonyms-->
		<label for="titleSynonyms" class="flex flex-item">
			<p class="flex-2">
				Title Synonyms
				<small ng-class="{active : showInstructions == 'titleSynonyms'}">{{ instructions.titleSynonyms }}
				</small>
			</p>
			<div class="flex-7">
				<input ng-focus="showInstructions = 'titleSynonyms'"
					   ng-model="createUmiForm.titleSynonyms" ng-maxlength="128"
					   type="text"
					   name="titleSynonyms"
					   placeholder="Title Synonyms"/>
			</div>
		</label>

		<!--Error messages for Title Synonyms-->
		<div class="error-messages" ng-show="showInstructions == 'titleSynonyms'">
			<div class="alert error" ng-show="formBasicSettings.titleSynonyms.$error.maxlength">{{ errorMessages.maxLength }}</div>
		</div>

		<label class="flex button-holder">
			<button name="next" class="button primary align-right" ng-disabled="!formBasicSettings.$valid" ng-click="activeStep = activeStep + 1">Proceed to <strong>{{ steps[stepsKeys[activeStep + 1]] }}</strong></button>
		</label>
	</form>

	<form name="formEditor" ng-show="activeStep == 1">
		<header class="container-narrow">
			<h2>Content for <strong>{{ createUmiForm.title }}</strong></h2>

			<p>To ensure every contribution is as relevant and valuable as possible, we feature automatic
				checker and validator, as well as interactive guidance to assist you with the process.</p>
		</header>

		<div class="flex latex-content-editor">
			<!--LaTeX Content-->
			<div class="flex-1">
				<textarea ng-focus="showInstructions = 'latexContent'"
				  ng-model="createUmiForm.latexContent" name="latexContent"
				  placeholder="LaTeX content" required></textarea>
			</div>

			<div class="flex-1">
				<p class="latex-content-preview" om-bind="createUmiForm.latexContent || 'LaTeX Content will be displayed here'"></p>
			</div>

			<!--Error messages for LaTeX Content-->
			<div class="error-messages full-screen" ng-show="showInstructions == 'latexContent'">
				<div class="alert error" ng-show="formEditor.latexContent.$error.required">{{ errorMessages.required }}</div>
			</div>
		</div>

		<div class="container-narrow">
			<!--Prerequisite definitions-->
			<label for="prerequisiteDefinitions" class="flex flex-item">
				<p class="flex-2">
					Prerequisite definitions
					<small ng-class="{active : showInstructions == 'prerequisiteDefinitions'}">{{ instructions.prerequisiteDefinitions }}
					</small>
				</p>
				<div class="flex-7" ng-controller="SearchController">
					<input ng-focus="$parent.showInstructions = 'prerequisiteDefinitions'"
						   ng-model="createUmiForm.prerequisiteDefinitions" ng-maxlength="128"
						   type="text"
						   name="prerequisiteDefinitions"
						   ng-change="search('createUmiForm.prerequisiteDefinitions', true)"
						   ng-keydown="searchResultsNavigate(searchResults, $event)"
						   placeholder="Prerequisite definitions"/>

					<div class="search-results" ng-show="showAutocomplete">
						<span ng-click="autocomplete('prerequisiteDefinitions', $index)" ng-repeat="result in searchResults.data" ng-class="{active : $index == searchResults.currentSelection}">{{result.title}}</span>
					</div>

					<div class="added-titles flex wrap" ng-show="autocompleteData.prerequisiteDefinitions">
						<span class="label" ng-repeat="(id, title) in autocompleteData.prerequisiteDefinitions">{{title}}<small class="flex center-horizontally center-vertically" ng-click="removeUmiId('prerequisiteDefinitions', id)">&times;</small></span>
					</div>
				</div>
			</label>

			<!--Error messages for Prerequisite definitions-->
			<div class="error-messages" ng-show="showInstructions == 'prerequisiteDefinitions'">
				<div class="alert error" ng-show="formEditor.prerequisiteDefinitions.$error.maxlength">{{ errorMessages.maxLength }}</div>
			</div>

			<!--See also-->
			<label for="seeAlso" class="flex flex-item">
				<p class="flex-2">
					See also
					<small ng-class="{active : showInstructions == 'seeAlso'}">{{ instructions.seeAlso }}
					</small>
				</p>

				<div class="flex-7" ng-controller="SearchController">
					<input ng-focus="$parent.showInstructions = 'seeAlso'" ng-model="createUmiForm.seeAlso"
						   ng-maxlength="128" type="text"
						   name="seeAlso"
						   ng-change="search('createUmiForm.seeAlso', true)"
						   ng-keydown="searchResultsNavigate(searchResults, $event)"
						   placeholder="See also"/>

					<div class="search-results" ng-show="showAutocomplete">
						<span ng-click="autocomplete('seeAlso', $index)" ng-repeat="result in searchResults.data" ng-class="{active : $index == searchResults.currentSelection}">{{result.title}}</span>
					</div>

					<div class="added-titles flex wrap" ng-show="$parent.autocompleteData.seeAlso">
						<span class="label" ng-repeat="(id, title) in $parent.autocompleteData.seeAlso">{{title}}<small class="flex center-horizontally center-vertically" ng-click="removeUmiId('seeAlso', id)">&times;</small></span>
					</div>
				</div>
			</label>

			<!--Error messages for See also-->
			<div class="error-messages" ng-show="showInstructions == 'seeAlso'">
				<div class="alert error" ng-show="formEditor.seeAlso.$error.maxlength">{{ errorMessages.maxLength }}</div>
			</div>

			<!--Tags-->
			<label for="tags" class="flex flex-item">
				<p class="flex-2">
					Tags
					<small ng-class="{active : showInstructions == 'tags'}">{{ instructions.tags }}
					</small>
				</p>

				<div class="flex-7">
					<input ng-focus="showInstructions = 'tags'" ng-model="createUmiForm.tags"
						   ng-maxlength="128" type="text" name="tags"
						   placeholder="Tags"/>
				</div>
			</label>

			<!--Error messages for Tags-->
			<div class="error-messages" ng-show="showInstructions == 'tags'">
				<div class="alert error" ng-show="formEditor.tags.$error.maxlength">{{ errorMessages.maxLength }}</div>
			</div>

			<label class="flex button-holder">
				<button name="next" class="button primary align-right" ng-disabled="!formEditor.$valid" ng-click="activeStep = activeStep + 1">Proceed to <strong>{{ steps[stepsKeys[activeStep + 1]] }}</strong></button>
			</label>
		</div>

		<!-- NOTE we should have a button which says skip additional settings and go to preview and publish -->
		<!--<label for="dispatchCreateUmi" class="flex button-holder">-->
			<!--<label for="dispatchCreateUmi" class="flex button-holder" ng-show="umiContributeForm.$valid">-->
			<!--<button name="next" class="button primary" ng-click="activeStep = activeStep + 1">Proceed to <strong>{{ steps[stepsKeys[activeStep + 1]] }}</strong></button>-->
		<!--</label>-->
	</form>

		<div class="container-narrow" ng-show="activeStep == 2">


		</div>

		<div class="container-narrow" ng-show="activeStep == 3">
			<p>Your contribution will be published under {{ omUser.email }}.</p>
			<span ng-click="createUmi()">show data</span>
			{{ contributeData }}
		</div>

	</form>
</article>

	<aside class="flex-5 flex column hide">
		<header>
			<h2>Live preview</h2>
			<p>This is what your contribution will look like as a single unit.</p>
		</header>

		<div class="umi-preview-holder flex-1 flex center-vertically center-horizontally">
			<div class="umi fade-in">
				<div class="content-holder">
					<div class="title flex center-vertically">
						<label
							ng-bind="createUmiForm.type.label || 'Contribution type'"></label>
						<strong class="flex-1"
								ng-bind="createUmiForm.title || 'Contribution Title'"></strong>
					</div>
					<article><p om-bind="createUmiForm.latexContent || 'LaTeX Content will be displayed
						here'"></p></article>
				</div>
			</div>
		</div>
	</aside>
</div>
